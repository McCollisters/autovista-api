container_commands:
  01_install:
    command: |
      echo "=== Installing dependencies ==="
      echo "Node version: $(node --version)"
      echo "NPM version: $(npm --version)"
      npm ci || (echo "npm ci failed, trying npm install" && npm install)
      echo "=== Dependencies installed ==="
    leader_only: true
  02_build:
    command: |
      echo "=== Building application ==="
      echo "Current directory: $(pwd)"
      echo "Node version: $(node --version)"
      npm run build || (echo "Build failed, checking for TypeScript errors" && npm run type-check)
      echo "=== Build completed ==="
    leader_only: true
  03_postbuild:
    command: |
      echo "=== Running postbuild script ==="
      node fix-imports.cjs || echo "Postbuild script failed but continuing..."
      echo "=== Postbuild completed ==="
    leader_only: true
  04_verify_build:
    command: |
      echo "=== Build Verification ==="
      echo "Checking if dist directory exists:"
      ls -la dist/ || echo "dist directory not found!"
      echo "Checking if index.js exists:"
      ls -la dist/index.js || echo "index.js not found!"
      echo "=== End Verification ==="
    leader_only: true

option_settings:
  aws:elasticbeanstalk:application:environment:
    NODE_ENV: "production"

